{% extends 'base.html' %}
{% load static %}
{% block content %}
<style>
    .nav-pills li a:hover {
        background-color: rgb(140, 61, 243);
    }
    #miTabla td,
    #miTabla th {
        padding: 0;
        height: 5px;

    }
    .card {
        border: 1px solid #ddd;
        background-color: #f5f5f5;
        box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
      }
</style>

<div class="container-fluid">

    <div class="row">
        <div class="d-flex flex-column justify-content-between col-auto bg-dark min-vh-100">
            <div class="mt-4">
                <a class="text-white d-none d-sm-inline text-decoration-none d-flex align-items-center ms-4"
                    role="button" href="">
                    <span class="fs-5">Registro de gastos</span>
                </a>
                <hr class="text-white d-none d-sm-block" />
                
                 <ul class="nav nav-pills flex-column mt-2 mt-sm-0" id="menu">
                    <li class="nav-item my-sm-1 my-2">
                        <a href="/listado_gastos_arren" class="nav-link text-white text-sm-start" aria-current="page">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-dash-circle" viewBox="0 0 16 16">
                                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                                <path d="M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8z"/>
                              </svg>
                            <span class="ms-2 d-none d-sm-inline"> Gastos por el arrendamiento <br> de habitaciones</span>

                        </a>
                    </li>
                    </li>
                </ul>
                 <ul class="nav nav-pills flex-column mt-2 mt-sm-0" id="menu">
                    <li class="nav-item my-sm-1 my-2">
                        <a href="/gasto_espacio" class="nav-link text-white text-sm-start" aria-current="page">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-dash-circle-fill" viewBox="0 0 16 16">
                                <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM4.5 7.5a.5.5 0 0 0 0 1h7a.5.5 0 0 0 0-1h-7z"/>
                              </svg>
                            <span class="ms-2 d-none d-sm-inline"> Gastos por el arrendamiento <br> de espacios</span>

                        </a>
                    </li>
                    </li>
                </ul>
                <ul class="nav nav-pills flex-column mt-2 mt-sm-0" id="menu">
                    <li class="nav-item my-sm-1 my-2">
                        <a href="/listado_gastos_arren" class="nav-link text-white text-sm-start" aria-current="page">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-file-earmark-text" viewBox="0 0 16 16">
                                <path d="M5.5 7a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1h-5zM5 9.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5z"/>
                                <path d="M9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4.5L9.5 0zm0 1v2A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z"/>
                              </svg>
                            <span class="ms-2 d-none d-sm-inline"> Listado de gastos por el <br> arrendamiento de habitaciones</span>

                        </a>
                    </li>
                    </li>
                </ul>
                <ul class="nav nav-pills flex-column mt-2 mt-sm-0" id="menu">
                    <li class="nav-item my-sm-1 my-2">
                        <a href="#" class="nav-link text-white text-sm-start" aria-current="page">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-file-earmark-text-fill" viewBox="0 0 16 16">
                                <path d="M9.293 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4.707A1 1 0 0 0 13.707 4L10 .293A1 1 0 0 0 9.293 0zM9.5 3.5v-2l3 3h-2a1 1 0 0 1-1-1zM4.5 9a.5.5 0 0 1 0-1h7a.5.5 0 0 1 0 1h-7zM4 10.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zm.5 2.5a.5.5 0 0 1 0-1h4a.5.5 0 0 1 0 1h-4z"/>
                              </svg>
                            <span class="ms-2 d-none d-sm-inline"> Listado de gastos por el <br> arrendamiento de espacios</span>

                        </a>
                    </li>
                    </li>
                </ul>
                <ul class="nav nav-pills flex-column mt-2 mt-sm-0" id="menu">
                    <li class="nav-item my-sm-1 my-2">
                        <a href="/gasto_salario" class="nav-link text-white text-sm-start" aria-current="page">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-currency-exchange" viewBox="0 0 16 16">
                                <path d="M0 5a5.002 5.002 0 0 0 4.027 4.905 6.46 6.46 0 0 1 .544-2.073C3.695 7.536 3.132 6.864 3 5.91h-.5v-.426h.466V5.05c0-.046 0-.093.004-.135H2.5v-.427h.511C3.236 3.24 4.213 2.5 5.681 2.5c.316 0 .59.031.819.085v.733a3.46 3.46 0 0 0-.815-.082c-.919 0-1.538.466-1.734 1.252h1.917v.427h-1.98c-.003.046-.003.097-.003.147v.422h1.983v.427H3.93c.118.602.468 1.03 1.005 1.229a6.5 6.5 0 0 1 4.97-3.113A5.002 5.002 0 0 0 0 5zm16 5.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0zm-7.75 1.322c.069.835.746 1.485 1.964 1.562V14h.54v-.62c1.259-.086 1.996-.74 1.996-1.69 0-.865-.563-1.31-1.57-1.54l-.426-.1V8.374c.54.06.884.347.966.745h.948c-.07-.804-.779-1.433-1.914-1.502V7h-.54v.629c-1.076.103-1.808.732-1.808 1.622 0 .787.544 1.288 1.45 1.493l.358.085v1.78c-.554-.08-.92-.376-1.003-.787H8.25zm1.96-1.895c-.532-.12-.82-.364-.82-.732 0-.41.311-.719.824-.809v1.54h-.005zm.622 1.044c.645.145.943.38.943.796 0 .474-.37.8-1.02.86v-1.674l.077.018z"/>
                              </svg>
                            <span class="ms-2 d-none d-sm-inline"> Gasto de salario</span>

                        </a>
                    </li>
                    </li>
                </ul>
                </ul>
            </div>
            <div>
                 <div class="dropdown show">
                    <a class="btn border-none outline-none text-white dropdown-toggle" type="button" id="triggerId"
                        data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                            class="bi bi-person-fill" viewBox="0 0 16 16">
                            <path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3Zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" />
                        </svg>
                        <span>{{user.username}}</span>
                    </a>
                    <div class="dropdown-menu" aria-labelledby="triggerId">

                        <a class="dropdown-item" href="/cerrar_sesion">Cerrar Sesión</a>

                    </div>
                </div>
            </div>

        </div>
        <div class="col-md-9">
            <!-- Información -->
            <br>
            <h1 class="text-center">Listado de gastos por el arrendamiento de espacio</h1>
            <br>
            
                <div class="container mt-5">
                    <div class="card">
                        <div class="card-body">
                <table class="table tabla-gastos" id="miTabla">
                    <thead>
                      <tr>
                        <th scope="col" class = "col-1">No.</th>
                        <th scope="col">Fecha</th>
                        <th scope="col">Detalle del gasto</th>
                        <th scope="col">Concepto</th>
                        <th scope="col">UM</th>
                        <th scope="col">Cantidad</th>
                        <th scope="col">Precio Unitario</th>
                        <th scope="col">Importe</th>
                        <th scope="col">Acciones</th>
                        
                      </tr>
                    </thead>
                    <tbody>
                        {% for gastos_esp in gastos_esp %}
                      <tr>
                        <th scope="row">{{ forloop.counter }}</th>
                        <td>{{gastos_esp.fecha|date:"d/m/Y"}}</td>
                        <td>{{gastos_esp.detalle_gasto}}</td>
                        <td>{{gastos_esp.concepto}}</td>
                        <td>{{gastos_esp.unidad_medida}}</td>
                        <td>{{gastos_esp.cantidad}}</td>
                        <td>{{gastos_esp.precio_unitario}}</td>
                        <td>{{gastos_esp.importe}}</td>
                        <td style="white-space: nowrap;">
                            <a href="#collapse_ver{{gastos_esp.id}}" 
                                            class="btn-outline-secondary d-inline-block" data-bs-toggle="modal" aria-expanded="false"
                                            data-bs-target="#collapse_ver{{gastos_esp.id}}"><i class="bi bi-eye"></i></a>

                            <a href="#collapse_edit{{gastos_esp.id}}" 
                            class="btn-outline-secondary d-inline-block" data-bs-toggle="modal" aria-expanded="false" data-bs-target="#collapse_edit{{gastos_esp.id}}"><i class="bi bi-pencil"></i></a>
                             
                            <a href="collapse_delete{{gastos_esp.id}}"
                            class="btn-outline-secondary d-inline-block" data-bs-toggle="modal" aria-expanded="false" data-bs-target="#collapse_delete{{gastos_esp.id}}"><i class="bi bi-trash"></i></a>
                        </td>
                      
                        
                      </tr>
                      
                       <!--Ver-->
                       <div class="modal fade" id="collapse_ver{{gastos_esp.id}}" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered modal-lg" style="width: 100%;">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h1 class="modal-title fs-5" id="staticBackdropLabel">Detalles del gasto de espacio</h1>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <form class="p-3" action="{% url 'ver_gasto_esp' gastos_esp.pk %}" method="POST">
                                    {% csrf_token %}
                                    <div class="modal-body row">
                                        <div class="col-md-3">
                                            <h3 class="modal-title fs-5 fw-bold">Fecha:</h3>
                                            <h3 class="modal-title fs-5">{{gastos_esp.fecha|date:"d/m/Y"}}</h3>
                                        </div>
                                        <div class="col-md-6">
                                            <h3 class="modal-title fs-5 fw-bold">Detalle de gasto:</h3>
                                            <h3 class="modal-title fs-5">{{gastos_esp.detalle_gasto}}</h3>
                                        </div>
                                        <div class="col-md-3">
                                            <h3 class="modal-title fs-5 fw-bold">Cantidad:</h3>
                                            <h3 class="modal-title fs-5">{{gastos_esp.cantidad}}</h3>
                                        </div>
                                        <div class="col-md-3">
                                            <h3 class="modal-title fs-5 fw-bold">Precio Unitario:</h3>
                                            <h3 class="modal-title fs-5">{{gastos_esp.precio_unitario}}</h3>
                                        </div>
                                        <div class="col-md-3">
                                            <h3 class="modal-title fs-5 fw-bold">Importe:</h3>
                                            <h3 class="modal-title fs-5">{{gastos_esp.importe}}</h3>
                                        </div>
                                        <div class="col-md-3">
                                            <h3 class="modal-title fs-5 fw-bold">Concepto:</h3>
                                            <h3 class="modal-title fs-5">{{gastos_esp.concepto}}</h3>
                                        </div>
                                        <div class="col-md-6">
                                            <h3 class="modal-title fs-5 fw-bold">Unidad de medida:</h3>
                                            <h3 class="modal-title fs-5">{{gastos_esp.unidad_medida}}</h3>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                        <!--Editar-->
                       <div class="modal fade" id="collapse_edit{{gastos_esp.id}}" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
                        <div class="modal-dialog modal-xl modal-dialog-centered">
                            <div class="modal-content">
                            <div class="modal-header">
                            <h1 class="modal-title fs-5" id="staticBackdropLabel">Modificar ingresos de espacio</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <form class="row g-3 p-3" action="{% url 'modificar_gastos_esp' gastos_esp.pk %}" method="POST">
                                {% csrf_token %}
                                <div class="modal-body row">
                                    <div class="col-6">
                                        <label for="validationDefault01" class="form-label">Fecha</label>
                                        <input type="date" name="fecha" value="{{gastos_esp.fecha|date:'Y-m-d'}}" class="form-control" id="validationDefault01" required>
                                    </div>
                                    <div class="col-6">
                                        <label for="validationDefault01" class="form-label">Detalle gasto</label>
                                        <input type="text" name="detalle_gasto" value="{{gastos_esp.detalle_gasto}}" class="form-control" id="validationDefault01" required>
                                    </div>
                                   
                                        <div class="col 6">
                                            <label for="validationDefault01" class="form-label">Cantidad</label>
                                            <input type="number" step="0,01" name="cantidad" value="{{gastos_esp.cantidad}}" class="form-control" id="validationDefault01" required>
                                        </div>
                                        <div class="col 6">
                                            <label for="validationDefault01" class="form-label">Precio Unitario</label>
                                            <input type="number" step="0,01" name="precio_unitario" value="{{gastos_esp.precio_unitario}}" class="form-control" id="validationDefault01" required>
                                        </div>
                                        <div class="col 6">
                                            <label for="validationDefault01" class="form-label">Importe</label>
                                            <input type="number" step="0,01" name="importe" value="{{gastos_esp.importe}}" class="form-control" id="validationDefault01" required>
                                        </div>
                                        <div class="col-md-3">
                                            <label for="validationDefault04" class="form-label">Concepto</label>
                                            <a class="btn btn-outline-primary btn-sm p-1" href="{% url 'create_concepto_esp'  %}">
                                                <i class="mdi mdi-plus"></i>
                                            </a>                      
                                            <select class="form-select" name="concepto" id="validationDefault04" required>
                                                {% if gastos_esp.concepto %}
                                                    <option value="{{ gastos_esp.concepto.id }}">{{ gastos_esp.concepto }}</option>
                                                {% else %}
                                                    <option selected disabled value="">Elegir...</option>
                                                {% endif %}
                                        
                                                {% for concepto_esp in concepto_esps %}
                                                <option value="{{concepto_esp.id}}">{{concepto_esp}}</option>

                                                {% endfor %}
                                            </select>
                                        </div> 
                                        <div class="col-md-3">
                                            <label for="validationDefault04" class="form-label">UM</label>
                                            <a class="btn btn-outline-primary btn-sm p-1" href="{% url 'create_um_esp'  %}">
                                                <i class="mdi mdi-plus"></i>
                                            </a>                      
                                            <select class="form-select" name="unidad_medida" id="validationDefault04" required>
                                                {% if gastos_esp.unidad_medida %}
                                                    <option value="{{ gastos_esp.unidad_medida.id }}">{{ gastos_esp.unidad_medida }}</option>
                                                {% else %}
                                                    <option selected disabled value="">Elegir...</option>
                                                {% endif %}
                                        
                                                {% for um_esp in um_esps %}
                                                <option value="{{um_esp.id}}">{{um_esp}}</option>

                                                {% endfor %}
                                            </select>
                                        </div> 
                                </div>
                            
                                <div class="col-12 d-grid gap-4 d-md-flex justify-content-md-end" style="padding: 10px;">
                                    <br>
                                <button class="btn btn-success" type="submit">
                                    Modificar
                                </button>
                
                                    <button class="btn btn-danger">
                                        Cancelar
                                    </button>
                
                                </div>
                            </form>   
                            
                        </div>
                        </div>
                    </div>

                      <!--Eliminar-->
                      <div class="modal fade" id="collapse_delete{{gastos_esp.id}}" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content">
                            <div class="modal-header">
                            <h1 class="modal-title fs-5" id="staticBackdropLabel">Eliminar ingreso de espacio</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <form class="row g-3 p-3" action="{% url 'delete_gastos_esp' gastos_esp.pk %}" method="POST">
                                {% csrf_token %}
                                <div class="modal-body">
                                    <h3 class="modal-title fs-5" id="staticBackdropLabel">¿Está seguro que desea eliminar el gasto: {{gastos_esp.concepto}}?</h3>
                                </div>
                                <div class="col-12 d-grid gap-4 d-md-flex justify-content-md-end" style="padding: 10px;">
                                    <br>
                                <button class="btn btn-danger" type="submit">
                                    Eliminar
                                </button>
                
                                    <a class="btn btn-primary" data-bs-dismiss="modal">
                                        Cancelar
                                    </a>
                
                                </div>
                            </form>   
                            
                        </div>
                        </div>
                    </div>
                
                    {% endfor %}
                    </tbody>
                     
                </table>
            </div>
        </div>
            </div>
            <script src="{% static 'jquery/jquery-3.5.1.min.js' %}"></script>
            <script type="text/javascript" src="{% static 'jquery/jquery.dataTables.min.js' %}"></script>
      
            <script>
             $(document).ready( function () {
             $('#miTabla').DataTable({
              language: {
              "decimal":        "",
              "emptyTable":     "No hay datos disponibles en la tabla",
              "info":           "Mostrando _START_ a _END_ de _TOTAL_ entradas",
              "infoEmpty":      "Mostrando 0 a 0 de 0 entradas",
              "infoFiltered":   "(filtrado de _MAX_ entradas totales)",
              "infoPostFix":    "",
              "thousands":      ",",
              "lengthMenu":     "Cantidad de entradas_MENU_",
              "loadingRecords": "Cargando...",
              "processing":     "Procesando...",
              "search":         "Buscar:",
              "zeroRecords":    "No se encontraron registros coincidentes",
              "paginate": {
                  "first":      "Primero",
                  "last":       "Último",
                  "next":       "Siguiente",
                  "previous":   "Anterior"
              },
          },
              });
          } );
      
            </script>
         
            <script src="{% static '/bootstrap/js/bootstrap.min.js' %}"></script>
          
          
          <div class="container">
            <a class="btn btn-outline-primary btn-sm rounded-pill shadow p-2" href="{% url 'home' %}"
                style="position: fixed; bottom: 25px;">
                <i class="bi bi-house-fill me-1"></i>Menú principal
            </a>
        </div>
      
  </div>
  
              
    </div>

    <script>
        let mySelect = document.getElementById("mySelect");
        let selectedValue = mySelect.value;
    </script>



    {% endblock %}